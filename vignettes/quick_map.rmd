```{r }
library(ncdf4)
library(raster)
i <- 1
for (model_version in c("osm", "fit_sdes_alnu_median", "fit_sdes_alnu_median5")) {

  date <- 20032900
  nc_path <- paste0("/scratch/sadamov/wd/20_alnu_", model_version, "/", date, "_c1e_tsa_alnu_", model_version, "/lm_coarse/lfff00150000") # This can be any netCDF file with POAC (e.g.)
  variable <- "ALNUsaisn"

  system(paste0("fxfilter --force -s ", variable, " ", nc_path, " -o ", nc_path, "_filtered"))
  system(paste0("fxconvert --force nc ", nc_path, "_filtered -o ", nc_path, "_filtered.nc"))

  con <- nc_open(paste0(nc_path, "_filtered.nc"))
  if (con$ndims == 5) {
    layer <- ncvar_get(con, paste(variable))[, , 80]
  } else {
    layer <- ncvar_get(con, paste(variable))
  }
  x <- ncvar_get(con, "lon_1")
  y <- ncvar_get(con, "lat_1")
  nc_close(con)

  if (variable %in% c("ALNU", "ALNUress", "ALNUreso", "ALNUfe",
                      "POAC", "POACress", "POACreso", "POACfe",
                      "BETU", "BETUress", "BETUreso", "BETUfe")) {
    layer <- log10(layer + 1)
  }

  if (i == 1){
    limits <- c(min(layer), max(layer))
  }

  r <- raster(layer,
    xmn = min(x), xmx = max(x),
    ymn = min(y), ymx = max(y))

  pal <- colorRampPalette(c("#4da17a", "#d32323"))
  plot(
    r,
  zlim = limits,
  col = pal(30),
  main = paste(model_version, date, variable))
  i <- 0
}
```